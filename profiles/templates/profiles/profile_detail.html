{% extends 'base.html' %}

{% block title %}
    {{object.user}}
{% endblock title %}

{% block content %}
    <div class='ui grid'>
        <br>
        <div class='row'>
            <div class='four wide column'>
                <img class='ui medium rounded image' src='{{object.avatar.url}}'>
                <h1>{{object.user}}</h1>
                <div class='ui vertical fluid menu'>
                    <div class='item'>
                        Posts
                        <div class='ui label'>{{object.get_posts_no}}</div>
                    </div>
                    <div class='item'>
                        Likes Given
                        <div class='ui label'>{{object.get_likes_given_no}}</div>
                    </div>
                    <div class='item'>
                        Likes Received
                        <div class='ui label'>{{object.get_likes_received_no}}</div>
                    </div><div class='item'>
                        Friends
                        <div class='ui label'>{{object.friends.all.count}}</div>
                    </div>
                </div>
                <div> <!-- Relationship Options (add friend, remove etc.)-->
                    
                <!-- Add Friend -->

                    <!-- If request user didn't send invite and pk user didn't send invite and request's user not in target user friends -->
                    {% if object.user not in invited_users and object.user not in incoming_invite_users and request.user not in object.friends.all %}
                        <form action='{% url 'profiles:send-invite' %}' method='POST'>
                            {% csrf_token %}
                            <input type='hidden' name='profile_pk' value='{{object.pk}}'>
                            <button style="margin-top:10px; width:200px;" type='submit' class='ui positive basic button mb-5 w-big'>
                                <i class='plus square icon'></i>
                                Add Friend
                            </button>
                        </form>
                    {% endif %}
                 
                <!-- Waiting for approval -->

                    <!-- If request user sent invite -->
                    {% if object.user in invited_users %}
                        <div>
                            <button style="margin-top:10px; width:200px;" class='ui disabled button mb-5 w-big'>
                                <i class='user icon'></i>
                                Waiting for approval
                            </button>
                        </div>
                    {% endif %}
                
                <!-- Accept Invite -->

                    <!-- If target user sent invite to request.user and request's user didn't send invite -->
                    {% if object.user in incoming_invite_users and object.user not in invited_users %}
                        <form action='{% url 'profiles:accept-invite' %}' method='POST'>
                            {% csrf_token %}
                            <input type='hidden' name='profile_pk' value='{{object.pk}}'>
                            <button style="margin-top:10px; width:200px;" type='submit' class='ui positive basic button mb-5 w-big'>
                                <i class='plus square icon'></i>
                                Accept Invite
                            </button>
                        </form>
                    {% endif %}

                <!-- Remove Friend -->

                    <!-- If request user in target user friends -->
                    {% if request.user in object.friends.all %}
                        <form action='{% url 'profiles:remove-friend' %}' method='POST'>
                            {% csrf_token %}
                            <input type='hidden' name='profile_pk' value='{{object.pk}}'>
                            <button style="margin-top:10px; width:200px;" type='submit' class='ui negative basic button mb-5 w-big'>
                                <i class='minus square icon'></i>
                                Remove Friend
                            </button>
                        </form>
                    {% endif %}
                
                <!-- Follow -->
                {% if object.user not in following %}
                    <form action='{% url "profiles:switch-follow-view" %}' method='POST'>
                        {% csrf_token %}
                        <input type='hidden' name='profile_pk' value='{{object.pk}}'>
                        <button style="margin-top:10px; width:200px;" type='submit' class='ui positive basic button mb-5 w-big'>
                            Follow
                        </button>
                    </form>
                    
                <!-- Unfollow -->
                {% else %}
                    <form action='{% url "profiles:switch-follow-view" %}' method='POST'>
                        {% csrf_token %}
                        <input type='hidden' name='profile_pk' value='{{object.pk}}'>
                        <button style="margin-top:10px; width:200px;" type='submit' class='ui negative basic button mb-5 w-big'>
                            Unfollow
                        </button>
                    </form>
                {% endif %}

                <!-- Send a message -->
                {% if request.user in object.friends.all %}
                    <a href="http://127.0.0.1:8000/profiles/chat/{{object.pk}}/">
                        <button style="margin-top:10px; width:200px;" type='submit' class='ui info teal basic button mb-5 w-big'>
                            Send a Message
                        </button>
                    </a>
                {% endif %}

                </div>
            </div>
            <div class='twelve wide column'>
                {% if len_posts %}
                    {% for post in posts  %}
                        <div class='segment ui fluid'>
                            <div class="post-content">
                                <h3>Post #{{forloop.revcounter}}</h3>
                                <small><strong>Created {{post.created|timesince}} ago</strong></small>
                                <hr>
                                {{post.content}}
                            </div>
                            {% if post.image %}
                            <div class="post-image">
                                <img class="img-src" src="{{post.image.url}}">
                            </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% else %}
                    <h1>This user hasn't posted anything yet..</h1>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock content %}